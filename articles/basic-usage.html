<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="opendatascotland">
<title>Basic Example • opendatascotland</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Basic Example">
<meta property="og:description" content="opendatascotland">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">opendatascotland</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-guides">Guides</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-guides">
    <a class="dropdown-item" href="../articles/basic-usage.html">Basic Guide</a>
    <a class="dropdown-item" href="../articles/riding-a-bike.html">Advanced Guide - Bike Hire</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Basic Example</h1>
            
      
      
      <div class="d-none name"><code>basic-usage.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="intro">Intro<a class="anchor" aria-label="anchor" href="#intro"></a>
</h2>
<p>A good place to start is by browsing datasets on <a href="https://opendata.scot/" class="external-link">opendata.scot</a>. You can filter and
search to find datasets of interests. The <code>openscotland</code> R
package can then download and save the datasets you are interested in.
This helps to quickly start analysis without needing to work out how to
save, organise and import data in R.</p>
</div>
<div class="section level2">
<h2 id="search">Search<a class="anchor" aria-label="anchor" href="#search"></a>
</h2>
<p>The <code>opendatascotland</code> package has a basic search function
for finding available datasets and viewing their metadata. Use
<code><a href="../reference/ods_search.html">ods_search()</a></code> function to view metadata for all datasets or
filter by matching search terms in the dataset’s title.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://fozy81.github.io/opendatascot/">opendatascotland</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View all available datasets and associated metadata</span></span>
<span><span class="va">all_datasets</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ods_search.html">ods_search</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Search dataset titles containing matching terms (case insensitive)</span></span>
<span><span class="va">single_query</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ods_search.html">ods_search</a></span><span class="op">(</span><span class="st">"Number of bikes"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Search multiple terms</span></span>
<span><span class="va">multi_query</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ods_search.html">ods_search</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Bins"</span>, <span class="st">"Number of bikes"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; The cached list of datasets from opendata.scot was last downloaded on 2023-10-09</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">multi_query</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 11</span></span>
<span><span class="co">#&gt;   unique_id            title organization notes category url   resources licence</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                &lt;chr&gt; &lt;chr&gt;        &lt;chr&gt; &lt;list&gt;   &lt;chr&gt; &lt;list&gt;    &lt;chr&gt;  </span></span>
<span><span class="co">#&gt; 1 Litter_Bins_Aberdee… Litt… Aberdeen Ci… "&lt;di… &lt;chr&gt;    /dat… &lt;df&gt;      UK Ope…</span></span>
<span><span class="co">#&gt; 2 Communal_Bins_City_… Comm… City of Edi… "&lt;p&gt;… &lt;chr&gt;    /dat… &lt;df&gt;      UK Ope…</span></span>
<span><span class="co">#&gt; 3 Grit_Bins_City_of_E… Grit… City of Edi… "&lt;p&gt;… &lt;chr&gt;    /dat… &lt;df&gt;      UK Ope…</span></span>
<span><span class="co">#&gt; 4 Salt_Bins_Dumfries_… Salt… Dumfries an… "&lt;p&gt;… &lt;chr&gt;    /dat… &lt;df&gt;      UK Ope…</span></span>
<span><span class="co">#&gt; 5 Roads_-_winter_main… Road… Stirling Co… "&lt;p&gt;… &lt;chr&gt;    /dat… &lt;df&gt;      UK Ope…</span></span>
<span><span class="co">#&gt; 6 Number_of_bikes_ava… Numb… Cycling Sco… "&lt;p&gt;… &lt;chr&gt;    /dat… &lt;df&gt;      UK Ope…</span></span>
<span><span class="co">#&gt; # ℹ 3 more variables: date_created &lt;chr&gt;, date_updated &lt;chr&gt;, org_type &lt;chr&gt;</span></span></code></pre></div>
<p>Note, search term is case-insensitive but word order must be correct
(there is no ‘fuzzy’ matching).</p>
</div>
<div class="section level2">
<h2 id="download">Download<a class="anchor" aria-label="anchor" href="#download"></a>
</h2>
<p>Currently, only datasets available in <code>.csv</code>,
<code>json</code> or <code>.geojson</code> can be downloaded. These
formats cover the majority of data available. You will be warned if a
dataset can’t be downloaded.</p>
<p>To download data, you can either download the metadata using
<code><a href="../reference/ods_search.html">ods_search()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">query</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ods_search.html">ods_search</a></span><span class="op">(</span><span class="st">"bins"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Note, the cached list of datasets from opendata.scot was last</span></span>
<span><span class="co">#&gt; downloaded on 2023-10-29</span></span></code></pre></div>
<p>Then pass that data frame to <code><a href="../reference/ods_get.html">ods_get()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ods_get.html">ods_get</a></span><span class="op">(</span><span class="va">query</span><span class="op">)</span></span></code></pre></div>
<p><strong><em>Or</em></strong> use the <code>search</code> argument in
<code>ods_get(search="my search term")</code> to search and download any
matching datasets in one step.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ods_get.html">ods_get</a></span><span class="op">(</span>search <span class="op">=</span> <span class="st">"bins"</span><span class="op">)</span></span></code></pre></div>
<p>By default, you will be asked if you want to save the data locally on
the first download. Optionally, you can refresh the data or avoid being
asked to save data by setting the <code>refresh</code> or
<code>ask</code> arguments.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ods_get.html">ods_get</a></span><span class="op">(</span>search <span class="op">=</span> <span class="st">"Number of bikes"</span>, refresh <span class="op">=</span> <span class="cn">TRUE</span>, ask <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plot">Plot<a class="anchor" aria-label="anchor" href="#plot"></a>
</h2>
<p>Once you have downloaded the dataset(s), you may wish to plot or map
the data. Here’s a short example of how plotting can be done.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ods_get.html">ods_get</a></span><span class="op">(</span>search <span class="op">=</span> <span class="st">"Recycling Point Locations"</span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="../reference/ods_get.html">ods_get()</a></code> function returned a named list of data
frames - lets select the one we want by name:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">recycling_points</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">Recycling_Points_Aberdeen_City_Council</span></span></code></pre></div>
<p>Or alternatively select the data frame using index/position of the
name in the list using <code>[[]]</code> notation.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Glass_and_textiles_recycling_points_Aberdeenshire_Council"</span></span>
<span><span class="co">#&gt; [2] "Recycling_Points_Aberdeen_City_Council"                   </span></span>
<span><span class="co">#&gt; [3] "Recycling_Points_Moray_Council"</span></span>
<span><span class="va">recycling_points</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<p>Geojson datasets are automating converted to <a href="https://r-spatial.github.io/sf/" class="external-link">simple feature</a> ‘sf’ data. As
we can see in the example the data frame is classed as “sf” which means
spatial / geometry attributes are baked in.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">recycling_points</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "sf"         "data.frame"</span></span></code></pre></div>
<p>You can see a <code>geometry</code> variable which contains the
spatial co-ordinates.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">recycling_points</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 3 features and 7 fields</span></span>
<span><span class="co">#&gt; Geometry type: POINT</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -2.173564 ymin: 57.13422 xmax: -2.070197 ymax: 57.20478</span></span>
<span><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span><span class="co">#&gt;   OBJECTID                            SITE</span></span>
<span><span class="co">#&gt; 1       47                      Asda, Dyce</span></span>
<span><span class="co">#&gt; 2       48                Balnagask Circle</span></span>
<span><span class="co">#&gt; 3       49 Bridge of Don, Park &amp; Ride AECC</span></span>
<span><span class="co">#&gt;                                      ADDRESS MIXED_YN TEXTILE_YN BOOKS_YN</span></span>
<span><span class="co">#&gt; 1            Riverview Drive, Dyce. AB21 7NG        Y          Y        N</span></span>
<span><span class="co">#&gt; 2                   Grampian Court, AB11 8TY        N          Y        N</span></span>
<span><span class="co">#&gt; 3 Exhibition Avenue, Bridge of Don. AB23 8BL        Y          Y        N</span></span>
<span><span class="co">#&gt;           UPRN                   geometry</span></span>
<span><span class="co">#&gt; 1 009051155534 POINT (-2.173564 57.20478)</span></span>
<span><span class="co">#&gt; 2 009051155535 POINT (-2.070197 57.13422)</span></span>
<span><span class="co">#&gt; 3 009051155536 POINT (-2.089188 57.18388)</span></span></code></pre></div>
<p>This allows the <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> function to automatically plot
the coordinates.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">recycling_points</span><span class="op">$</span><span class="va">geometry</span>, col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">recycling_points</span><span class="op">$</span><span class="va">TEXTILE_YN</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="basic-usage_files/figure-html/plot-1.png" width="700"></p>
<div class="section level3">
<h3 id="json">JSON<a class="anchor" aria-label="anchor" href="#json"></a>
</h3>
<p>Some datasets are only available in JSON or CSV formats, unlike
formats such as GeoJSON, these do not automatically have spatial
geometry. For example, the Glasgow cycling counts data does have
<code>latitude</code> and <code>longitude</code> variables but is
downloaded as JSON and therefore does not have spatial geometry added by
default. This type of data is downloaded as a data frame without a
<code>geometry</code> column.</p>
<p>Let’s download the Glasgow cycle counts data which is only available
in JSON format.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cycle_count</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ods_get.html">ods_get</a></span><span class="op">(</span>search <span class="op">=</span> <span class="st">"lasgow City Council - Daily cycling counts from automatic cycling counters"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cycle_count</span> <span class="op">&lt;-</span> <span class="va">cycle_count</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cycle_count</span>, <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 10</span></span></span>
<span><span class="co">#&gt;   provider      area  siteID location latitude longitude startTime endTime count</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Glasgow City… Glas… GLG01… CP West…     55.9     -<span style="color: #BB0000;">4.27</span> 2016-04-… 2016-0…   291</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Glasgow City… Glas… GLG01… CP St V…     55.9     -<span style="color: #BB0000;">4.28</span> 2016-04-… 2016-0…     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Glasgow City… Glas… GLG01… CP Sauc…     55.9     -<span style="color: #BB0000;">4.28</span> 2016-04-… 2016-0…     0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Glasgow City… Glas… GLG00… Cathedr…     55.9     -<span style="color: #BB0000;">4.24</span> 2016-04-… 2016-0…     0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1 more variable: usmart_id &lt;chr&gt;</span></span></span></code></pre></div>
<p>We can see the cycle count JSON has been converted into a ‘flat’
tabulated data frame. This data frame can now be plotted as a chart, in
the following example, let’s use the <code>ggplot2</code> plotting
library to create a graph. We’ll display counts over time for each
location.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span></span>
<span><span class="co"># Convert character to date (to display date time correctly)</span></span>
<span><span class="va">cycle_count</span><span class="op">$</span><span class="va">Date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">cycle_count</span><span class="op">$</span><span class="va">startTime</span>, <span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cycle_count</span> <span class="op">&lt;-</span> <span class="va">cycle_count</span><span class="op">[</span><span class="va">cycle_count</span><span class="op">$</span><span class="va">Date</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2022-12-31"</span><span class="op">)</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># Plot</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">cycle_count</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>, y <span class="op">=</span> <span class="va">count</span>, colour <span class="op">=</span> <span class="va">location</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>date_labels <span class="op">=</span> <span class="st">"%b-%Y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">comma</span><span class="op">)</span></span></code></pre></div>
<p><img src="basic-usage_files/figure-html/time_series-1.png" width="480"></p>
<p>This is a bit noisy so lets sum the counts for all locations to see
total cycle counts.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Group by date and sum the count</span></span>
<span><span class="va">sum_cycle_count</span> <span class="op">&lt;-</span> <span class="va">cycle_count</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Date</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>`Total Count` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#  Graph the new `sum_count` variable</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sum_cycle_count</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Date</span>, y <span class="op">=</span> <span class="va">`Total Count`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>date_labels <span class="op">=</span> <span class="st">"%b-%Y"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">comma</span><span class="op">)</span></span></code></pre></div>
<p><img src="basic-usage_files/figure-html/sum-1.png" width="480"></p>
<p>We can also use the latitude and longitude columns to plot the points
on a map.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.10.2, GDAL 3.4.1, PROJ 8.2.1; sf_use_s2() is TRUE</span></span>
<span><span class="co"># Convert data frame into 'sf' geospatial dataframe</span></span>
<span><span class="va">cycle_counts_geo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">cycle_count</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"longitude"</span>, <span class="st">"latitude"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Sum counts by location</span></span>
<span><span class="va">cycle_counts_geo_sum</span> <span class="op">&lt;-</span> <span class="va">cycle_counts_geo</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">location</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>`Total Cycle Count` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># plot</span></span>
<span><span class="va">c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">cycle_counts_geo_sum</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>size <span class="op">=</span> <span class="va">`Total Cycle Count`</span><span class="op">)</span>, colour <span class="op">=</span> <span class="st">"blue"</span>, fill <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">c</span></span></code></pre></div>
<p><img src="basic-usage_files/figure-html/points-1.png" width="480"></p>
<p>Can you guess which points in Glasgow are most popular for cyclists?
We can add a base layer map to reveal the streets.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dkahle/ggmap" class="external-link">ggmap</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create bounding box to download background street map layer</span></span>
<span><span class="va">bbox_glasgow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">cycle_counts_geo_sum</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">bbox_glasgow</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"bottom"</span>, <span class="st">"right"</span>, <span class="st">"top"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Download background layer</span></span>
<span><span class="va">glasgow</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html" class="external-link">ggmap</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/get_stamenmap.html" class="external-link">get_stamenmap</a></span><span class="op">(</span><span class="va">bbox_glasgow</span>,</span>
<span>  zoom <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  https <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  messaging <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot background with cycle counts on top</span></span>
<span><span class="va">cycle_map</span> <span class="op">&lt;-</span> <span class="va">glasgow</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">cycle_counts_geo_sum</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">geometry</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">geometry</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    size <span class="op">=</span> <span class="va">`Total Cycle Count`</span></span>
<span>  <span class="op">)</span>,</span>
<span>  col <span class="op">=</span> <span class="st">"green"</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.4</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">cycle_map</span></span></code></pre></div>
<p><img alt="Cycle Trips Map" src="https://github.com/fozy81/opendatascot/blob/master/vignettes/images/cycle-points.png?raw=true" width="400" align="center"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'purrr'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:magrittr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     set_names</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:scales':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     discard</span></span></code></pre>
<p>Looks like <a href="https://www.openstreetmap.org/#map=17/55.85323/-4.25175" class="external-link">Victoria
Bridge</a> area is a hot spot for cyclists.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Tim Foster.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
