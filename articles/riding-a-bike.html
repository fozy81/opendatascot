<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="opendatascotland">
<title>Riding a Bike • opendatascotland</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Riding a Bike">
<meta property="og:description" content="opendatascotland">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">opendatascotland</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-docs">Docs</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-docs">
    <a class="dropdown-item" href="../articles/basic-usage.html">Basic Examples</a>
    <a class="dropdown-item" href="../articles/riding-a-bike.html">Worked Example</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Riding a Bike</h1>
            
      
      
      <div class="d-none name"><code>riding-a-bike.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>Let’s take a look at the Glasgow bike hire trip data. First, load all
the libraries we’ll need for the analysis. Note, you may need to install
these first.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># You may need to install packages</span></span>
<span><span class="co"># Install `devtools`:  install.packages("devtools")</span></span>
<span><span class="co"># Install `opendatascotland`: devtools::install_github("fozy81/opendatascot")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://fozy81.github.io/opendatascot/">opendatascotland</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ropensci.r-universe.dev/av" class="external-link">av</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dkahle/ggmap" class="external-link">ggmap</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://hms.tidyverse.org/" class="external-link">hms</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dcooley.github.io/sfheaders/" class="external-link">sfheaders</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gganimate.com" class="external-link">gganimate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/thomasp85/transformr" class="external-link">transformr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="meta-data">Meta-data<a class="anchor" aria-label="anchor" href="#meta-data"></a>
</h2>
<p>Search <a href="opendata.scot">opendata.scot</a> for meta-data about
Glasgow Next Bike Cycle Hire trips, this describes the data and who
provides it. Also we can confirm which open data licence is being
used.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Search and download</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>metadata <span class="ot">&lt;-</span> <span class="fu">ods_search</span>(<span class="at">search =</span> <span class="st">"Next Bike Cycle Hire - Glasgow"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>metadata<span class="sc">$</span>licence</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span><span class="er">&gt;</span> [<span class="dv">1</span>] <span class="st">"UK Open Government Licence v3.0"</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="download">Download<a class="anchor" aria-label="anchor" href="#download"></a>
</h2>
<p>Using the meta-data, we can download the raw cycle trips data
directly from the provider and save it to our computer for future (and
quick) reference.</p>
<pre class="{r"><code><span><span class="va">trips</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ods_get.html">ods_get</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span></span>
<span><span class="co"># Data is returned as a list of data frames, extract first data frame in the</span></span>
<span><span class="co"># list.</span></span>
<span><span class="va">trips</span> <span class="op">&lt;-</span> <span class="va">trips</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="stats">Stats<a class="anchor" aria-label="anchor" href="#stats"></a>
</h2>
<p>Here we’ll get some summary stats to help us understand the data.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">median_duration</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">trips</span><span class="op">$</span><span class="va">Duration</span><span class="op">)</span> <span class="op">/</span> <span class="fl">60</span><span class="op">)</span>, <span class="st">"mins"</span><span class="op">)</span></span></code></pre></div>
<p>Median trip duration is around: <code>14 mins</code></p>
<p>Top 3 start locations:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trips</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">`Rental place`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">count</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">.</span>, format <span class="op">=</span> <span class="st">"simple"</span>, align <span class="op">=</span> <span class="st">"c"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="center">Rental place</th>
<th align="center">count</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">St Enoch Square - ELECTRIC</td>
<td align="center">52587</td>
</tr>
<tr class="even">
<td align="center">Broomielaw - ELECTRIC</td>
<td align="center">51374</td>
</tr>
<tr class="odd">
<td align="center">Glasgow Green</td>
<td align="center">46414</td>
</tr>
</tbody>
</table>
<p>Top 3 return locations:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trips</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">`Return place`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="op">-</span><span class="va">count</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">.</span>, format <span class="op">=</span> <span class="st">"simple"</span>, align <span class="op">=</span> <span class="st">"c"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="center">Return place</th>
<th align="center">count</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">St Enoch Square - ELECTRIC</td>
<td align="center">52087</td>
</tr>
<tr class="even">
<td align="center">Broomielaw - ELECTRIC</td>
<td align="center">50047</td>
</tr>
<tr class="odd">
<td align="center">Partick Interchange</td>
<td align="center">48725</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="start-time">Start Time<a class="anchor" aria-label="anchor" href="#start-time"></a>
</h3>
<p>Below is a plot of trip start times over 24hrs. Looks as expected:
Peaks in morning rush hours 7.30-9.30 and evening around 6pm. Quiet at
4am.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Start time of day (hour)</span></span>
<span><span class="va">trips</span><span class="op">$</span><span class="va">hour</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/IDateTime.html" class="external-link">hour</a></span><span class="op">(</span><span class="va">trips</span><span class="op">$</span><span class="va">`Start time`</span><span class="op">)</span></span>
<span><span class="co"># ggplot bar chart</span></span>
<span><span class="va">hour_plot</span> <span class="op">&lt;-</span> <span class="va">trips</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hour</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">..count..</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"pink"</span>, high <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">hour_plot</span></span></code></pre></div>
<p><img src="riding-a-bike_files/figure-html/time-of-day-1.png" width="480"></p>
</div>
<div class="section level3">
<h3 id="annual-monthly-usage">Annual monthly usage<a class="anchor" aria-label="anchor" href="#annual-monthly-usage"></a>
</h3>
<p>We can see significant usage in winter but almost a doubling of usage
in summer months. Although, usage in 2022 looks a little unusual.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Extract year (as character to help plot as discrete categories in chart)</span></span>
<span><span class="va">trips</span><span class="op">$</span><span class="va">year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/IDateTime.html" class="external-link">year</a></span><span class="op">(</span><span class="va">trips</span><span class="op">$</span><span class="va">`Start time`</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Extract month as abbreviated 'Aug'...</span></span>
<span><span class="va">trips</span><span class="op">$</span><span class="va">month</span> <span class="op">&lt;-</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html" class="external-link">month</a></span><span class="op">(</span><span class="va">trips</span><span class="op">$</span><span class="va">`Start time`</span>, abbr <span class="op">=</span> <span class="cn">TRUE</span>, label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># Plot bar chart</span></span>
<span><span class="va">month_plot</span> <span class="op">&lt;-</span> <span class="va">trips</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">month</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">month_plot</span></span></code></pre></div>
<p><img src="riding-a-bike_files/figure-html/monthly-usage-1.png" width="480"></p>
</div>
<div class="section level3">
<h3 id="map-trip-start-points">Map trip start points<a class="anchor" aria-label="anchor" href="#map-trip-start-points"></a>
</h3>
<p>Here we plot the start location using background map data from <a href="https://www.openstreetmap.org/copyright" class="external-link">OpenStreetMap</a>. We can
see bike hire trips being used widely across the city. There’s some
strange lat/lon start points which need to be filtered out. Not sure
what explains these but filter to a bounding box around Glasgow
helps.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Clean out weird points:</span></span>
<span><span class="co"># View the outliers like this: hist(trips$`START LAT`)</span></span>
<span><span class="va">trips</span> <span class="op">&lt;-</span> <span class="va">trips</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">`START LAT`</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">`START LONG`</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="va">`START LAT`</span> <span class="op">&lt;</span> <span class="fl">55.9</span> <span class="op">&amp;</span></span>
<span>    <span class="va">`START LAT`</span> <span class="op">&gt;</span> <span class="fl">55.8</span> <span class="op">&amp;</span></span>
<span>    <span class="va">`START LONG`</span> <span class="op">&lt;</span> <span class="op">-</span><span class="fl">4.0</span> <span class="op">&amp;</span></span>
<span>    <span class="va">`START LONG`</span> <span class="op">&gt;</span> <span class="op">-</span><span class="fl">4.4</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="map">Map<a class="anchor" aria-label="anchor" href="#map"></a>
</h4>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert data frame into 'sf' geospatial dataframe</span></span>
<span><span class="va">trips</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">trips</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"START LONG"</span>, <span class="st">"START LAT"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Bounding box for background map</span></span>
<span><span class="va">bbox</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">trips</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">bbox</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="st">"bottom"</span>, <span class="st">"right"</span>, <span class="st">"top"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Download background map using bounding box</span></span>
<span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressMessages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/ggmap.html" class="external-link">ggmap</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/ggmap/man/get_stamenmap.html" class="external-link">get_stamenmap</a></span><span class="op">(</span><span class="va">bbox</span>, zoom <span class="op">=</span> <span class="fl">12</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot background with trips start points on top</span></span>
<span><span class="va">cycle_map</span> <span class="op">&lt;-</span> <span class="va">map</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">trips</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">geometry</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">geometry</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  colour <span class="op">=</span> <span class="st">"hotpink1"</span>,</span>
<span>  pch <span class="op">=</span> <span class="fl">16</span>,</span>
<span>  size <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  alpha <span class="op">=</span> <span class="fl">0.3</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">cycle_map</span></span></code></pre></div>
<p><img src="riding-a-bike_files/figure-html/map-stat-point-1.png" width="480"></p>
</div>
</div>
<div class="section level3">
<h3 id="start-and-end-trips">Start and End Trips<a class="anchor" aria-label="anchor" href="#start-and-end-trips"></a>
</h3>
<p>Let’s explore trips that start and finish at a different location.
This may give some insight into the lengths of journeys taken. We ignore
trips that started and ended in the same place, as we can’t tell how far
or where they went.</p>
<ul>
<li>Remove points with missing data</li>
<li>Remove points outside Glasgow area</li>
<li>Remove trips with same start and end point</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trips</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ods_get.html">ods_get</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span></span>
<span><span class="co">#&gt; 'Next Bike Cycle Hire - Glasgow Trip Data (2017-2023)' dataset was last downloaded on 2023-05-15</span></span>
<span><span class="va">trips</span> <span class="op">&lt;-</span> <span class="va">trips</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">trips</span> <span class="op">&lt;-</span> <span class="va">trips</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">`START LAT`</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">`START LONG`</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">`END LAT`</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">`END LONG`</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>    <span class="va">`START LAT`</span> <span class="op">&lt;</span> <span class="fl">55.9</span> <span class="op">&amp;</span></span>
<span>    <span class="va">`START LAT`</span> <span class="op">&gt;</span> <span class="fl">55.8</span> <span class="op">&amp;</span></span>
<span>    <span class="va">`START LONG`</span> <span class="op">&lt;</span> <span class="op">-</span><span class="fl">4.1</span> <span class="op">&amp;</span></span>
<span>    <span class="va">`START LONG`</span> <span class="op">&gt;</span> <span class="op">-</span><span class="fl">4.4</span> <span class="op">&amp;</span></span>
<span>    <span class="va">`END LAT`</span> <span class="op">&lt;</span> <span class="fl">55.9</span> <span class="op">&amp;</span></span>
<span>    <span class="va">`END LAT`</span> <span class="op">&gt;</span> <span class="fl">55.8</span> <span class="op">&amp;</span></span>
<span>    <span class="va">`END LONG`</span> <span class="op">&lt;</span> <span class="op">-</span><span class="fl">4.1</span> <span class="op">&amp;</span></span>
<span>    <span class="va">`END LONG`</span> <span class="op">&gt;</span> <span class="op">-</span><span class="fl">4.4</span> <span class="op">&amp;</span></span>
<span>    <span class="va">`END LONG`</span> <span class="op">!=</span> <span class="va">`START LONG`</span> <span class="op">&amp;</span></span>
<span>    <span class="va">`END LAT`</span> <span class="op">!=</span> <span class="va">`START LAT`</span><span class="op">)</span></span>
<span><span class="va">trips</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">trips</span>, <span class="va">`Start time`</span><span class="op">)</span></span>
<span><span class="va">trips</span><span class="op">$</span><span class="va">week</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/IDateTime.html" class="external-link">week</a></span><span class="op">(</span><span class="va">trips</span><span class="op">$</span><span class="va">`Start time`</span><span class="op">)</span></span>
<span><span class="va">trips</span><span class="op">$</span><span class="va">month</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/IDateTime.html" class="external-link">month</a></span><span class="op">(</span><span class="va">trips</span><span class="op">$</span><span class="va">`Start time`</span><span class="op">)</span></span>
<span><span class="va">trips</span><span class="op">$</span><span class="va">year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/IDateTime.html" class="external-link">year</a></span><span class="op">(</span><span class="va">trips</span><span class="op">$</span><span class="va">`Start time`</span><span class="op">)</span></span>
<span><span class="va">trips</span><span class="op">$</span><span class="va">month</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_pad.html" class="external-link">str_pad</a></span><span class="op">(</span><span class="va">trips</span><span class="op">$</span><span class="va">month</span>, pad <span class="op">=</span> <span class="fl">0</span>, width <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">trips</span><span class="op">$</span><span class="va">week</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_pad.html" class="external-link">str_pad</a></span><span class="op">(</span><span class="va">trips</span><span class="op">$</span><span class="va">week</span>, pad <span class="op">=</span> <span class="fl">0</span>, width <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">trips</span><span class="op">$</span><span class="va">year_month</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">trips</span><span class="op">$</span><span class="va">year</span>, <span class="va">trips</span><span class="op">$</span><span class="va">month</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">trips</span><span class="op">$</span><span class="va">year_week</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">trips</span><span class="op">$</span><span class="va">year</span>, <span class="va">trips</span><span class="op">$</span><span class="va">week</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">trips</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">trips</span>, arrival_month <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trips</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">trips</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="va">trips</span>,</span>
<span>  start_long <span class="op">=</span> <span class="va">`START LONG`</span>,</span>
<span>  start_lat <span class="op">=</span> <span class="va">`START LAT`</span>,</span>
<span>  finish_long <span class="op">=</span> <span class="va">`END LONG`</span>,</span>
<span>  finish_lat <span class="op">=</span> <span class="va">`END LAT`</span></span>
<span><span class="op">)</span></span>
<span><span class="va">trips</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trips</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="distance">Distance<a class="anchor" aria-label="anchor" href="#distance"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">trips</span></span>
<span><span class="co"># Use this to reduce data to make it run fast /</span></span>
<span><span class="co"># less RAM needed: data &lt;- data %&gt;% filter(year_month &lt; 201711)</span></span>
<span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="va">data</span><span class="op">[</span>, <span class="va">line_id</span> <span class="op">:=</span> <span class="va">.I</span><span class="op">]</span> <span class="co">## Each row is a line</span></span>
<span><span class="co">## create a long-form of the data</span></span>
<span><span class="va">dt_line</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/rbindlist.html" class="external-link">rbindlist</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="va">data</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">arrival_month</span>,</span>
<span>      <span class="va">year_month</span>,</span>
<span>      <span class="va">line_id</span>,</span>
<span>      lon <span class="op">=</span> <span class="va">start_long</span>,</span>
<span>      lat <span class="op">=</span> <span class="va">start_lat</span>, sequence <span class="op">=</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span><span class="op">]</span>,</span>
<span>    <span class="va">data</span><span class="op">[</span>, <span class="fu">.</span><span class="op">(</span><span class="va">arrival_month</span>,</span>
<span>      <span class="va">year_month</span>,</span>
<span>      <span class="va">line_id</span>,</span>
<span>      lon <span class="op">=</span> <span class="va">finish_long</span>,</span>
<span>      lat <span class="op">=</span> <span class="va">finish_lat</span>,</span>
<span>      sequence <span class="op">=</span> <span class="fl">2</span></span>
<span>    <span class="op">)</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setorder.html" class="external-link">setorder</a></span><span class="op">(</span><span class="va">dt_line</span>, <span class="va">line_id</span>, <span class="va">sequence</span><span class="op">)</span></span>
<span><span class="va">sf</span> <span class="op">&lt;-</span> <span class="fu">sfheaders</span><span class="fu">::</span><span class="fu"><a href="https://dcooley.github.io/sfheaders/reference/sf_multilinestring.html" class="external-link">sf_multilinestring</a></span><span class="op">(</span></span>
<span>  obj <span class="op">=</span> <span class="va">dt_line</span>,</span>
<span>  x <span class="op">=</span> <span class="st">"lon"</span>,</span>
<span>  y <span class="op">=</span> <span class="st">"lat"</span>,</span>
<span>  multilinestring_id <span class="op">=</span> <span class="st">"arrival_month"</span>,</span>
<span>  linestring_id <span class="op">=</span> <span class="st">"line_id"</span>,</span>
<span>  keep <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="va">sf</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fl">4326</span> <span class="co">## Assume it's in Web Mercator</span></span></code></pre></div>
<p>Summarize the average ‘as the crow flies’ trip distances:</p>
<ul>
<li><p><strong>Max distance:</strong> 13719m</p></li>
<li><p><strong>Min distance:</strong> 0.13m (!)</p></li>
<li><p><strong>Average distance:</strong> 1962m</p></li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="map-1">Map<a class="anchor" aria-label="anchor" href="#map-1"></a>
</h2>
<p>Here we plot all the trips as straight line.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">sf</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="va">year_month</span><span class="op">)</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">lims</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4.4</span>, <span class="fl">4.1</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">55.8</span>, <span class="fl">55.9</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"All Trips"</span><span class="op">)</span></span>
<span><span class="va">g</span></span></code></pre></div>
<p><img src="riding-a-bike_files/figure-html/trip-map-1.png" width="480"></p>
<div class="section level3">
<h3 id="animation">Animation<a class="anchor" aria-label="anchor" href="#animation"></a>
</h3>
<p>Plotting all the lines at once blocks and covers many lines, so let’s
animate the trips as they are taken.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">steps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">1000</span>, to <span class="op">=</span> <span class="fl">664586</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sf</span><span class="op">)</span> <span class="op">/</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sf</span><span class="op">$</span><span class="va">year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/IDateTime.html" class="external-link">year</a></span><span class="op">(</span><span class="va">trips</span><span class="op">$</span><span class="va">`Start time`</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">steps</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">steps</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">make_plot</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">steps</span>, <span class="kw">function</span><span class="op">(</span><span class="va">step</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">sf</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">step</span>, <span class="op">]</span></span>
<span>    <span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span></span>
<span>        data <span class="op">=</span> <span class="va">data</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>          colour <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">arrival_month</span>,</span>
<span>          alpha <span class="op">=</span> <span class="fl">0.9</span></span>
<span>        <span class="op">)</span>,</span>
<span>        show.legend <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>      <span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">lims</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4.4</span>, <span class="fl">4.1</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">55.8</span>, <span class="fl">55.9</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>        plot.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"black"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>        plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span></span>
<span>          color <span class="op">=</span> <span class="st">"purple"</span>,</span>
<span>          size <span class="op">=</span> <span class="fl">14</span>,</span>
<span>          face <span class="op">=</span> <span class="st">"bold"</span>,</span>
<span>          hjust <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>          vjust <span class="op">=</span> <span class="fl">0</span></span>
<span>        <span class="op">)</span></span>
<span>      <span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_colour_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"blue"</span>, high <span class="op">=</span> <span class="st">"violet"</span>, trans <span class="op">=</span> <span class="st">"reverse"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">video_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"output.gif"</span><span class="op">)</span></span>
<span><span class="fu">av</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/av/reference/capturing.html" class="external-link">av_capture_graphics</a></span><span class="op">(</span><span class="fu">make_plot</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">video_file</span>,</span>
<span>  <span class="fl">512</span>,</span>
<span>  <span class="fl">480</span>,</span>
<span>  vfilter <span class="op">=</span> <span class="st">"framerate=fps=4"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img alt="Trips Animation" src="https://github.com/fozy81/opendatascot/blob/master/vignettes/images/output.gif?raw=true" width="450" align="center"></p>
<ul>
<li>This still ends up looking like a blob of colour…</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="routes">Routes<a class="anchor" aria-label="anchor" href="#routes"></a>
</h2>
<p>Let’s take the start and end point of the trip and use a route
planning engine to provide a line. This route plan uses the cycle
network, avoiding busy roads.</p>
<p>NOTE: This requires having the <a href="http://project-osrm.org/" class="external-link">Open Source Routing Machine</a> (OSRM)
library installed locally. Please follow link and install. Additionally,
the OpenStreetMap data for Scotland needs to be downloaded and add to
OSRM.</p>
<p>Running this code may take many days!…</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># loop through sf and find a route from osrm...</span></span>
<span><span class="va">steps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span>from <span class="op">=</span> <span class="fl">1000</span>, to <span class="op">=</span> <span class="fl">664586</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">trips</span><span class="op">)</span> <span class="op">/</span> <span class="fl">500</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">map_df</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">trips</span>, <span class="va">trips</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">trip</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="va">trip</span><span class="op">$</span><span class="va">id</span><span class="op">)</span> <span class="co"># 249534 last id saved.</span></span>
<span>  <span class="va">url</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>    <span class="st">"http://127.0.0.1:5000/route/v1/bicycle/"</span>,</span>
<span>    <span class="va">trip</span><span class="op">$</span><span class="va">start_long</span>, <span class="st">","</span>, <span class="va">trip</span><span class="op">$</span><span class="va">start_lat</span>, <span class="st">";"</span>,</span>
<span>    <span class="va">trip</span><span class="op">$</span><span class="va">finish_long</span>, <span class="st">","</span>, <span class="va">trip</span><span class="op">$</span><span class="va">finish_lat</span>,</span>
<span>    <span class="st">"?steps=false&amp;geometries=geojson"</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">route</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="op">(</span><span class="fu">curl</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/curl/man/curl.html" class="external-link">curl</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">route</span> <span class="op">&lt;-</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">fromJSON</a></span><span class="op">(</span><span class="va">route</span><span class="op">)</span></span>
<span>  <span class="va">json_route</span> <span class="op">&lt;-</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">toJSON</a></span><span class="op">(</span><span class="va">route</span><span class="op">$</span><span class="va">routes</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span></span>
<span>  <span class="co"># Need to remove '[' bracket at start and end of json.</span></span>
<span>  <span class="va">json_route</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">json_route</span>, start <span class="op">=</span> <span class="fl">2</span>, stop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nchar.html" class="external-link">nchar</a></span><span class="op">(</span><span class="va">json_route</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="va">geo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="va">json_route</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span><span class="va">geo</span>, <span class="st">"trips.geojson"</span>, append <span class="op">=</span> <span class="cn">TRUE</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="animate-routes">Animate Routes<a class="anchor" aria-label="anchor" href="#animate-routes"></a>
</h3>
<p>This section requires <a href="https://ffmpeg.org/" class="external-link">ffmpeg</a> system
library to be installed to give fine control to generating gif and mpegs
videos.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">routes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">st_read</a></span><span class="op">(</span><span class="st">"trips.geojson"</span><span class="op">)</span></span>
<span><span class="va">trips</span><span class="op">$</span><span class="va">day</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/day.html" class="external-link">day</a></span><span class="op">(</span><span class="va">trips</span><span class="op">$</span><span class="va">`Start time`</span><span class="op">)</span></span>
<span><span class="va">trips</span><span class="op">$</span><span class="va">day</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_pad.html" class="external-link">str_pad</a></span><span class="op">(</span><span class="va">trips</span><span class="op">$</span><span class="va">day</span>, pad <span class="op">=</span> <span class="fl">0</span>, width <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">trips</span><span class="op">$</span><span class="va">year_day</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">trips</span><span class="op">$</span><span class="va">year</span>, <span class="va">trips</span><span class="op">$</span><span class="va">week</span>, <span class="va">trips</span><span class="op">$</span><span class="va">day</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">map_routes3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html" class="external-link">bind_cols</a></span><span class="op">(</span><span class="va">routes</span>, <span class="va">trips</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">routes</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="va">map_routes3</span><span class="op">$</span><span class="va">lat_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span></span>
<span>  from <span class="op">=</span> <span class="op">-</span><span class="fl">4.29202</span>,</span>
<span>  to <span class="op">=</span> <span class="op">-</span><span class="fl">4.4</span>,</span>
<span>  by <span class="op">=</span> <span class="op">-</span><span class="op">(</span><span class="op">(</span><span class="op">-</span><span class="fl">4.26202</span> <span class="op">-</span> <span class="op">-</span><span class="fl">4.4</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">routes</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">routes</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">map_routes3</span><span class="op">$</span><span class="va">lat_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span></span>
<span>  from <span class="op">=</span> <span class="op">-</span><span class="fl">4.21866</span>,</span>
<span>  to <span class="op">=</span> <span class="op">-</span><span class="fl">4.1</span>,</span>
<span>  by <span class="op">=</span> <span class="op">-</span><span class="op">(</span><span class="op">(</span><span class="op">-</span><span class="fl">4.24866</span> <span class="op">-</span> <span class="op">-</span><span class="fl">4.1</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">routes</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">routes</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">map_routes3</span><span class="op">$</span><span class="va">lon_3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span></span>
<span>  from <span class="op">=</span> <span class="fl">55.8347</span>,</span>
<span>  to <span class="op">=</span> <span class="fl">55.8</span>,</span>
<span>  by <span class="op">=</span> <span class="op">-</span><span class="op">(</span><span class="op">(</span><span class="fl">55.8647</span> <span class="op">-</span> <span class="fl">55.7</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">routes</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">routes</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">map_routes3</span><span class="op">$</span><span class="va">lon_4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span></span>
<span>  from <span class="op">=</span> <span class="fl">55.8966</span>,</span>
<span>  to <span class="op">=</span> <span class="fl">55.9</span>,</span>
<span>  by <span class="op">=</span> <span class="op">-</span><span class="op">(</span><span class="op">(</span><span class="fl">55.8666</span> <span class="op">-</span> <span class="fl">55.9</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">routes</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">routes</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="va">steps</span> <span class="op">&lt;-</span> <span class="va">trips</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">routes</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">year_day</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>steps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">steps</span><span class="op">$</span><span class="va">id</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">steps</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">plots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">steps</span>, <span class="va">steps</span><span class="op">$</span><span class="va">id</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">step</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;-</span> <span class="va">step</span><span class="op">$</span><span class="va">id</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span>  <span class="va">data</span> <span class="op">&lt;-</span> <span class="va">map_routes3</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">step</span><span class="op">$</span><span class="va">steps</span>, <span class="op">]</span></span>
<span>  <span class="va">lat_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">lat_1</span><span class="op">)</span></span>
<span>  <span class="va">lat_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">lat_2</span><span class="op">)</span></span>
<span>  <span class="va">lon_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">lon_3</span><span class="op">)</span></span>
<span>  <span class="va">lon_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">lon_4</span><span class="op">)</span></span>
<span>  <span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span></span>
<span>      data <span class="op">=</span> <span class="va">data</span>, mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>        colour <span class="op">=</span> <span class="va">arrival_month</span>,</span>
<span>        alpha <span class="op">=</span> <span class="fl">0.9</span></span>
<span>      <span class="op">)</span>,</span>
<span>      show.legend <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="co"># Fixed lat/lon:</span></span>
<span>    <span class="co"># lims(x = c(4.4, 4.1), y = c(55.8, 55.9)) +</span></span>
<span>    <span class="co"># Dynamic lat/lon:</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">lims</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lat_1</span>, <span class="va">lat_2</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lon_1</span>, <span class="va">lon_2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">year</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>      plot.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"black"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>,</span>
<span>      plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span></span>
<span>        color <span class="op">=</span> <span class="st">"purple"</span>,</span>
<span>        size <span class="op">=</span> <span class="fl">14</span>,</span>
<span>        face <span class="op">=</span> <span class="st">"bold"</span>,</span>
<span>        hjust <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>        vjust <span class="op">=</span> <span class="fl">0</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_colour_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"blue"</span>, high <span class="op">=</span> <span class="st">"violet"</span>, trans <span class="op">=</span> <span class="st">"reverse"</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">plots</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">715</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">plot</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"routes/"</span>, <span class="va">n</span>, <span class="st">".png"</span><span class="op">)</span>,</span>
<span>    plot <span class="op">=</span> <span class="va">plot</span>,</span>
<span>    width <span class="op">=</span> <span class="fl">5</span>,</span>
<span>    height <span class="op">=</span> <span class="fl">4</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="va">n</span> <span class="op">&lt;&lt;-</span> <span class="va">n</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Use ffmpeg system / command line library:</span></span>
<span><span class="co"># ffmpeg -f image2 -framerate 15 -i 'routes/%d.png' -vcodec libx264</span></span>
<span><span class="co"># -crf 22 video.mp4</span></span>
<span><span class="co"># ffmpeg -i video.mp4 -r 4 -s 512x420 output.gif</span></span></code></pre></div>
<p>The resulting animations shows the shortest routes cyclists may use
to travel A to B using the cycle network. Of course, people hiring bikes
may have chosen a different route but it gives some idea how the
transport network in Glasgow is used by those hiring bikes.</p>
<p><img alt="Routes Animation" src="https://github.com/fozy81/opendatascot/blob/master/vignettes/images/routes.gif?raw=true" width="450" align="center"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Tim Foster.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
